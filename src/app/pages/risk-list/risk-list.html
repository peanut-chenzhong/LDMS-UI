<div class="page-container">
  <!-- 页面标题 -->
  <div class="page-header">
    <h1 class="page-title">Risk Analysis List</h1>
    <p class="page-desc">View identified risks and issues from Hudi table analysis.</p>
  </div>

  <!-- 筛选栏 -->
  <div class="filter-bar">
    <div class="filter-controls">
      <div class="filter-item">
        <label class="filter-label">Database</label>
        <ti-select
          [(ngModel)]="selectedDatabase"
          [options]="allDatabases"
          [searchable]="true"
          [clearable]="true"
          placeholder="选择或输入database"
          style="width: 200px;">
        </ti-select>
      </div>
      <div class="filter-item">
        <label class="filter-label">TableName</label>
        <ti-select
          [(ngModel)]="selectedTableName"
          [options]="allTableNames"
          [searchable]="true"
          [clearable]="true"
          placeholder="选择或输入表名"
          style="width: 200px;">
        </ti-select>
      </div>
      <div class="filter-item">
        <label class="filter-label">风险类型</label>
        <ti-select
          [(ngModel)]="selectedRiskType"
          [options]="riskTypeOptions"
          [clearable]="true"
          placeholder="选择风险类型"
          style="width: 160px;">
        </ti-select>
      </div>
    </div>
    <div class="filter-actions">
      <button tiButton type="button" color="primary" (click)="onSearch()">Search</button>
      <button tiButton type="button" (click)="onReset()">Reset</button>
    </div>
  </div>

  <!-- 表格区域 -->
  <div class="table-container">
    <ti-table
      [srcData]="srcData"
      [(displayedData)]="displayedRisks"
      [columns]="displayedColumns">
      <table>
        <thead>
          <tr>
            <th width="120">数据库名</th>
            <th width="180">表名</th>
            <th width="130">风险类型</th>
            <th width="160" class="sortable" (click)="onSort('alertTime')">
              预警时间
              <span class="sort-icon" [class.active]="sortField === 'alertTime'">
                @if (sortField === 'alertTime') {
                  {{ sortDirection === 'asc' ? '↑' : '↓' }}
                } @else {
                  ↕
                }
              </span>
            </th>
            <th>原因</th>
          </tr>
        </thead>
        <tbody>
          @for (risk of displayedRisks; track risk.id) {
            <tr>
              <td>{{ risk.database }}</td>
              <td>{{ risk.tablename }}</td>
              <td>
                <span class="risk-badge" [ngClass]="getRiskTypeClass(risk.riskType)">
                  {{ risk.riskType }}
                </span>
              </td>
              <td>{{ risk.alertTime }}</td>
              <td class="reason-cell">{{ risk.reason }}</td>
            </tr>
          } @empty {
            <tr>
              <td colspan="5" class="empty-cell">暂无风险数据</td>
            </tr>
          }
        </tbody>
      </table>
    </ti-table>

    <!-- 分页控件 -->
    <ti-pagination
      [(currentPage)]="pagination.currentPage"
      [pageSize]="pagination.pageSize"
      [totalNumber]="pagination.totalNumber"
      (pageUpdate)="onPageUpdate($event)">
    </ti-pagination>
  </div>
</div>
