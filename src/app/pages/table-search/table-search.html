<div class="page-container">
  <!-- È°µÈù¢Ê†áÈ¢ò -->
  <div class="page-header">
    <h1 class="page-title">Table Search</h1>
    <p class="page-desc">Query and browse table metadata information across databases.</p>
  </div>

  <!-- Á≠õÈÄâÊ†è -->
  <div class="filter-bar">
    <div class="filter-controls">
      <div class="filter-item">
        <label class="filter-label">Database</label>
        <div class="search-dropdown-container">
          <input 
            type="text" 
            class="filter-input filter-input-dropdown" 
            [(ngModel)]="filters.database"
            (input)="onDatabaseInputChange()"
            (focus)="onDatabaseFocus()"
            (keyup.enter)="onSearch()"
            placeholder="ÈÄâÊã©ÊàñËæìÂÖ•database">
          <span class="dropdown-arrow">‚ñº</span>
          @if (showDatabaseDropdown && filteredDatabases.length > 0) {
            <div class="search-dropdown">
              @for (db of filteredDatabases; track db) {
                <div 
                  class="dropdown-item" 
                  [class.selected]="filters.database === db"
                  (click)="selectDatabase(db)">
                  {{ db }}
                </div>
              }
            </div>
          }
        </div>
      </div>
      <div class="filter-item">
        <label class="filter-label">TableName</label>
        <div class="search-dropdown-container">
          <input 
            type="text" 
            class="filter-input filter-input-dropdown" 
            [(ngModel)]="filters.tableName"
            (input)="onTableNameInputChange()"
            (focus)="onTableNameFocus()"
            (keyup.enter)="onSearch()"
            placeholder="ÈÄâÊã©ÊàñËæìÂÖ•Ë°®Âêç">
          <span class="dropdown-arrow">‚ñº</span>
          @if (showTableNameDropdown && filteredTableNames.length > 0) {
            <div class="search-dropdown">
              @for (table of filteredTableNames; track table) {
                <div 
                  class="dropdown-item"
                  [class.selected]="filters.tableName === table"
                  (click)="selectTableName(table)">
                  {{ table }}
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>
    <div class="filter-actions">
      <button class="btn btn-primary" (click)="onSearch()">Search</button>
      <button class="btn btn-secondary" (click)="onReset()">Reset</button>
    </div>
  </div>

  <!-- Ë°®Ê†ºÂå∫Âüü -->
  <div class="table-container">
    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <!-- Âõ∫ÂÆöÂàó -->
            @for (col of fixedColumns; track col.key) {
              <th class="fixed-col">{{ col.label }}</th>
            }
            <!-- ÂèØÊãñÊãΩÂàó -->
            @for (col of draggableColumns; track col.key; let i = $index) {
              <th 
                class="draggable-col"
                [class.sortable]="col.sortable"
                draggable="true"
                (dragstart)="onDragStart($event, i)"
                (dragover)="onDragOver($event, i)"
                (dragend)="onDragEnd()"
                (drop)="onDrop($event, i)"
                [class.drag-over]="dragOverIndex === i"
                (click)="col.sortable ? onSort(col.key) : null">
                <span class="drag-handle">‚ãÆ‚ãÆ</span>
                {{ col.label }}
                @if (col.sortable) {
                  <span class="sort-icon" [class.active]="sortField === col.key">
                    @if (sortField === col.key) {
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    } @else {
                      ‚Üï
                    }
                  </span>
                }
              </th>
            }
          </tr>
        </thead>
        <tbody>
          @for (row of paginatedData; track row.tablename) {
            <tr 
              [class.selected]="selectedRow === row"
              (click)="onRowSelect(row)">
              <!-- Âõ∫ÂÆöÂàóÊï∞ÊçÆ -->
              @for (col of fixedColumns; track col.key) {
                <td class="fixed-col">{{ row[col.key] }}</td>
              }
              <!-- ÂèØÊãñÊãΩÂàóÊï∞ÊçÆ -->
              @for (col of draggableColumns; track col.key) {
                <td>{{ row[col.key] }}</td>
              }
            </tr>
          } @empty {
            <tr>
              <td [attr.colspan]="fixedColumns.length + draggableColumns.length" class="empty-cell">No data available</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- ÂàÜÈ°µÊéß‰ª∂ -->
    <div class="pagination">
      <div class="pagination-left">
        <span class="pagination-total">Total {{ filteredData.length }} items</span>
        <div class="page-size-selector">
          <label>ÊØèÈ°µ</label>
          <select [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange()">
            @for (size of pageSizeOptions; track size) {
              <option [value]="size">{{ size }}</option>
            }
          </select>
          <label>Êù°</label>
        </div>
      </div>
      <div class="pagination-controls">
        <button 
          class="pagination-btn" 
          [disabled]="currentPage === 1"
          (click)="goToPage(currentPage - 1)">
          ‚Äπ Prev
        </button>
        @for (page of visiblePages; track page) {
          @if (page === '...') {
            <span class="pagination-ellipsis">...</span>
          } @else {
            <button 
              class="pagination-btn pagination-num"
              [class.active]="currentPage === page"
              (click)="goToPage(+page)">
              {{ page }}
            </button>
          }
        }
        <button 
          class="pagination-btn"
          [disabled]="currentPage === totalPages"
          (click)="goToPage(currentPage + 1)">
          Next ‚Ä∫
        </button>
      </div>
    </div>
  </div>

  <!-- ÊäòÁ∫øÂõæÂå∫Âüü -->
  @if (selectedRow) {
    <div class="chart-section">
      <div class="chart-header">
        <h3 class="chart-title">
          <span class="chart-icon">üìä</span>
          {{ selectedRow.database }}.{{ selectedRow.tablename }} - 30Â§©Ë∂ãÂäø
        </h3>
        <button class="btn-close" (click)="selectedRow = null">‚úï</button>
      </div>
      <div class="chart-container">
        <canvas baseChart
          [data]="lineChartData"
          [options]="lineChartOptions"
          type="line">
        </canvas>
      </div>
    </div>
  }
</div>
