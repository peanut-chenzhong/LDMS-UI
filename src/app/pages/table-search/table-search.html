<div class="page-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <div class="page-header">
    <h1 class="page-title">Table Search</h1>
    <p class="page-desc">Query and browse table metadata information across databases.</p>
  </div>

  <!-- ç­›é€‰æ  -->
  <div class="filter-bar">
    <div class="filter-controls">
      <div class="filter-item">
        <label class="filter-label">Database</label>
        <ti-select
          [(ngModel)]="selectedDatabase"
          [options]="allDatabases"
          [searchable]="true"
          [clearable]="true"
          placeholder="é€‰æ‹©æˆ–è¾“å…¥database"
          style="width: 200px;">
        </ti-select>
      </div>
      <div class="filter-item">
        <label class="filter-label">TableName</label>
        <ti-select
          [(ngModel)]="selectedTableName"
          [options]="allTableNames"
          [searchable]="true"
          [clearable]="true"
          placeholder="é€‰æ‹©æˆ–è¾“å…¥è¡¨å"
          style="width: 200px;">
        </ti-select>
      </div>
    </div>
    <div class="filter-actions">
      <button tiButton type="button" color="primary" (click)="onSearch()">Search</button>
      <button tiButton type="button" (click)="onReset()">Reset</button>
    </div>
  </div>

  <!-- è¡¨æ ¼åŒºåŸŸ -->
  <div class="table-container">
    <ti-table #myTable
      [srcData]="srcData"
      [(displayedData)]="displayedData"
      [columns]="displayedColumns">
      <table>
        <thead>
          <tr>
            @for (col of displayedColumns; track col.field) {
              <th 
                [class.sortable]="col.sortable"
                (click)="col.sortable ? onSort(col.field) : null">
                {{ col.title }}
                @if (col.sortable) {
                  <span class="sort-icon" [class.active]="sortField === col.field">
                    @if (sortField === col.field) {
                      {{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}
                    } @else {
                      â†•
                    }
                  </span>
                }
              </th>
            }
          </tr>
        </thead>
        <tbody>
          @for (row of displayedData; track row.tablename) {
            <tr (click)="onRowClick(row)" [class.selected]="selectedRow === row">
              @for (col of displayedColumns; track col.field) {
                <td>
                  @if (col.field === 'tablesize' || col.field === 'filenumber' || col.field === 'archivelogsize') {
                    {{ row[col.field] | number }}
                  } @else {
                    {{ row[col.field] }}
                  }
                </td>
              }
            </tr>
          } @empty {
            <tr>
              <td [attr.colspan]="displayedColumns.length" class="empty-cell">No data available</td>
            </tr>
          }
        </tbody>
      </table>
    </ti-table>

    <!-- åˆ†é¡µæŽ§ä»¶ -->
    <ti-pagination
      [(currentPage)]="pagination.currentPage"
      [pageSize]="pagination.pageSize"
      [totalNumber]="pagination.totalNumber"
      (pageUpdate)="onPageUpdate($event)">
    </ti-pagination>
  </div>

  <!-- æŠ˜çº¿å›¾åŒºåŸŸ -->
  @if (selectedRow) {
    <div class="chart-section">
      <div class="chart-header">
        <h3 class="chart-title">
          <span class="chart-icon">ðŸ“Š</span>
          {{ selectedRow.database }}.{{ selectedRow.tablename }} - 30å¤©è¶‹åŠ¿
        </h3>
        <button tiButton type="button" variant="text" (click)="selectedRow = null">âœ•</button>
      </div>
      <div class="chart-container">
        <canvas baseChart
          [data]="lineChartData"
          [options]="lineChartOptions"
          type="line">
        </canvas>
      </div>
    </div>
  }
</div>
